# Render.com Deployment Configuration
# This file defines infrastructure for deploying PatchHive to Render

databases:
  - name: patchhive-db
    databaseName: patchhive
    user: patchhive
    plan: free
    # Render will automatically set up PostgreSQL 15

services:
  # Backend API (FastAPI with Docker)
  - type: web
    name: patchhive-api
    runtime: docker
    plan: free
    dockerfilePath: ./Dockerfile.backend
    dockerContext: .
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: patchhive-db
          property: connectionString
      - key: CORS_ORIGINS
        value: https://patchhive-frontend.onrender.com
      - key: SECRET_KEY
        generateValue: true
      - key: PORT
        value: 10000
    healthCheckPath: /health
    autoDeploy: true

  # Frontend (React/Vite with Docker + Nginx)
  - type: web
    name: patchhive-frontend
    runtime: docker
    plan: free
    dockerfilePath: ./Dockerfile.frontend
    dockerContext: .
    envVars:
      - key: VITE_API_URL
        value: https://patchhive-api.onrender.com
      - key: PORT
        value: 8080
    healthCheckPath: /health
    autoDeploy: true
